import discord
import asyncio
import random
from discord.ext import commands

# Discord bot setup
intents = discord.Intents.default()
client = commands.Bot(command_prefix='/', intents=intents)

# Get the bot token from the environment variable
bot_token = os.environ.get('DISCORD_BOT_TOKEN')
if not bot_token:
    print('Error: no bot token specified in DISCORD_BOT_TOKEN environment variable')
    exit(1)


# List of dungeons
dungeons = [
    'Рассвет Бесконечности: Падение Галакронда', 'Рассвет Бесконечности: Подъем Дорнозму',
    'Усадьба Уэйкрестов', 'Атал\'Дазар', 'Чаща Темного Сердца',
    'Крепость Черной Ладьи', 'Вечное цветение', 'Трон Приливов'
]
boss_numbers = ["на первом боссе", "на втором боссе", "на третьем боссе", "на последнем боссе"]
consequences = [
    "в итоге вся группа погибла", 
    "это привело к серии ошибок", 
    "в результате мы потеряли ключ", 
    "и это значительно замедлило нас"
]
# Function to generate a random story
def generate_story():
    actions = ['пообещал дать боп на первом боссе', 'забыл использовать щит', 'не увернулся от атаки',    "забыл использовать основной защитный кулдаун",
    "использовал Божественное вмешательство на DPS вместо лечения",
    "пропустил важный интерапт",
    "промахнулся Молотом Гнева",
    "активировал Авангард в самый неподходящий момент",
    "пытался танковать босса лицом к группе",
    "стоял в огне, забыв про уклонение",
    "пытался использовать слабые ауры",
    "проигнорировал крики о помощи от лекаря",
    "забыл сменить таланты перед боссом",
    "перепутал цель и танковал моба, а не босса",
    "отвлекся на диалог в гильдейском чате",
    "пытался поймать редкого пета посреди боя",
    "пропустил вызов к дуэли от другого игрока",
    "забыл про механику отражения урона боссом",
    "случайно вышел из игры в середине боя",
    "перепутал клавиши и использовал эмоцию вместо атаки",
    "пытался соло танковать аддов без поддержки",
    "забыл надеть правильную броню",
    "использовал предметы для лечения вместо защиты",
    "отправился в AFK в самый ответственный момент",
    "забыл, как работает новый навык",
    "случайно отключил важные аддоны",
    "пытался обменяться предметами во время боя",
    "игнорировал советы опытных игроков",
    "использовал атакующие заклинания вместо оборонительных",
    "пытался применить стратегию из устаревшего гайда",
    "отвлекся на новости в чате",
    "не заметил, что его здоровье критически низко",
    "забыл про баффы перед боем",
    "игнорировал индикаторы опасности",
    "отвлекся на настройку интерфейса",
    "пытался дать советы другим, забывая про свои обязанности",
    "забыл о механике контроля толпы",
    "пытался пройти через зону с высоким уровнем радиации",
    "использовал неподходящее заклинание для баффа группы",
    "забыл вовремя сменить оружие",
    "игнорировал предупреждения о заминированных участках",
    "пытался использовать устаревшие тактики",
    "забыл про механику смены фаз у босса",
    "отвлекся на разгадывание головоломки в инвентаре",
    "пропустил сигнал к отступлению",
    "не использовал способность к быстрому перемещению",
    "забыл про механику специфического дебаффа",
    "игнорировал сигналы к регрупировке",
    "промахнулся по цели при использовании специальной атаки",
    "не заметил активации ловушки",
    "использовал неверные команды для коммуникации",
    "забыл про важный элемент интерфейса",
    "пытался использовать старые стратегии в новой обнове"]
    reasons = ['ибо он все равно тебе не помог бы', 'но отвлекся на кошку', 'потому что забыл как это делается',     "потому что думал, что это усилит нашу атаку",
    "но забыл, что он на кулдауне",
    "чтобы показать свой новый маунт",
    "поскольку был слишком занят разговорами в чате",
    "не зная, что это самый худший выбор в этой ситуации",
    "думая, что это стратегия против этого босса",
    "игнорируя предупреждения от команды",
    "под влиянием недопонимания механик",
    "чтобы показать свои DPS-навыки, которых не было",
    "потому что забыл, как играть после долгого перерыва",
    "под давлением неожиданного вызова к дуэли",
    "из-за прерывания соединения в критический момент",
    "пытаясь выполнить случайное задание на фоне боя",
    "подражая стратегии, увиденной в YouTube-видео",
    "из-за неправильной настройки клавиш",
    "пытаясь впечатлить новых игроков в группе",
    "забыв о последствиях для остальной группы",
    "из-за ошибки в понимании текущей меты",
    "чтобы проверить новый билд, о котором читал на форуме",
    "под влиянием слишком многих гайдов",
    "забыв о важности поддержания агро",
    "пытаясь избежать ответственности за поражение",
    "из-за невнимательности к изменениям в патчноутах",
    "подражая действиям другого танка в прошлом рейде",
    "из-за стресса от предыдущих неудачных попыток",
    "думая, что это добавит элемент неожиданности",
    "игнорируя советы более опытных игроков",
    "пытаясь сократить время боя",
    "из-за недооценки сложности босса",
    "пытаясь применить слишком сложные тактики",
    "забыв о базовых принципах игры за свой класс",
    "из-за перегрузки информацией от аддонов",
    "пытаясь пройти на неверном уровне сложности",
    "под влиянием неверной оценки ситуации",
    "из-за неправильного понимания роли в группе",
    "пытаясь привлечь внимание к своему персонажу",
    "под давлением времени на выполнение ключа",
    "из-за неправильного прочтения гайдов",
    "пытаясь выполнить секретную задачу",
    "думая, что команда справится без его помощи",
    "из-за недостатка опыта в подобных боях",
    "подражая действиям персонажей из книг по WoW",
    "из-за путаницы в тактике группы",
    "пытаясь исправить ошибку другого игрока",
    "думая, что это повысит его рейтинг",
    "пытаясь сделать бой более динамичным",
    "из-за переоценки своих способностей",
    "под впечатлением от прошлых успешных боев",
    "из-за путаницы с интерфейсом игры",
    "пытаясь адаптироваться к новым механикам игры"]
    return f'Я {action} {boss_number}, {reason}, {consequence}.'

# Task to send dungeon announcement and follow-up story
async def dungeon_run_task():
    while True:
        # Wait for a random time before announcing a dungeon
        await asyncio.sleep(random.randint(2, 17) * 60 * 60)  # Random time in hours converted to seconds

        # Send dungeon announcement
        dungeon = random.choice(dungeons)
        keystone_level = random.randint(2, 17)
        announcement = f'пошли в ключ? {dungeon} {keystone_level}'
        channel = client.get_channel(712008433443799151)
        await channel.send(announcement)

        # Wait for 1-3 hours before sending follow-up story
        await asyncio.sleep(random.randint(1, 3) * 60 * 60)  # 1-3 hours in seconds

        # Send follow-up story
        story = generate_story()
        await channel.send(story)

def generate_welcome_message(member):
    bad_bot_message = random.choice([
    "Привет! Я здесь, чтобы напомнить, как плохо я играю. Надеюсь, ты покажешь себя лучше!",
    "Добро пожаловать! Как новый член, ты должен знать, что мои навыки игры оставляют желать лучшего.",
    "Я рад видеть новое лицо, потому что мои провалы в игре уже ни для кого не новость.",
    "Всем известно, что я не лучший игрок. Но я верю, что ты сможешь показать класс!",
    "Приветствую! Надеюсь, ты не будешь играть так же плохо, как я.",
    "Моя репутация плохого игрока уже обросла легендами. Докажи, что ты не такой!",
    "Я известен своей ужасной игрой. Но ты, наверное, лучше!",
    "В гильдии много отличных игроков, но я, к сожалению, не из их числа.",
    "Мои неудачи в игре уже стали притчей во языцех. Покажи, как нужно играть!",
    "Добро пожаловать! Я здесь, чтобы напомнить, что даже самые плохие игроки, как я, найдут здесь своё место."
    ])

    mighty_guild_master_message = random.choice([
       "Наш глава гильдии – настоящий мастер и лидер. От него можно многому научиться!",
    "Если у тебя возникнут вопросы, обращайся к нашему великому главе гильдии. Он знает всё!",
    "Наш глава – это пример истинного мастерства и мудрости. Он всегда поможет и подскажет!",
    "Глава нашей гильдии обладает невероятными навыками и знаниями. Ты в хороших руках!",
    "Помни, что наш глава гильдии – это легенда, и его советы бесценны.",
    "Если тебе нужен пример для подражания, наш глава гильдии – идеальный выбор.",
    "Наш глава гильдии всегда знает, как действовать в любой ситуации. Его опыт неоценим.",
    "Обращайся к нашему главе гильдии за мудрыми советами – он настоящий лидер.",
    "Глава гильдии – это наша гордость. Его лидерство и мастерство восхищают.",
    "Нет лучшего наставника и лидера, чем наш глава гильдии. Его опыт поможет тебе стать лучше."
    ])

    return (
        f"{member.mention}, добро пожаловать в нашу гильдию!\n"
        f"{bad_bot_message}\n"
        f"{mighty_guild_master_message}\n"
        "Не забудь написать свой игровой ник и настоящее имя в Дискорде. "
        "Если у тебя есть вопросы, обращайся к нашему главе гильдии!"
    )

@client.event
async def on_ready():
    print(f'{client.user} has connected to Discord!')
    client.loop.create_task(dungeon_run_task())

@client.event
async def on_member_join(member):
    # Generate the welcome message
    welcome_message = generate_welcome_message(member)

    # Specify the channel where you want to send the welcome message
    # Replace 'YOUR_WELCOME_CHANNEL_ID' with the actual channel ID
    channel = client.get_channel(712008433443799151)

    # Send the welcome message
    await channel.send(welcome_message)

client.run(bot_token)
